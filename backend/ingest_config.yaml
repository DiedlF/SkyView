# Skyview Ingest Configuration
# Controls which variables are downloaded and how grids are handled.

region:
  icon-d2: full          # Use native grid (no crop) — 746×1215
  icon-eu: full          # Use full ICON-EU coverage (no crop)

# D2 full domain bounds (used for EU cropping)
d2_bounds:
  lat_min: 43.18
  lat_max: 58.08
  lon_min: -3.94
  lon_max: 20.34

retention:
  keep_runs: 1           # Latest run only

# Optional ingest profiles (Phase 4 migration)
# - full: legacy behavior (all enabled groups)
# - skyview_core: minimal set needed for Skyview core app; Explorer may miss variables
profiles:
  full:
    include_groups:
      - aviation
      - surface_weather
      - severe_weather
      - soaring

  skyview_core:
    variables:
      # Skyview overlays / symbols / computed fields
      - ww
      - cape_ml
      - htop_dc
      - hbas_sc
      - htop_sc
      - lpi
      - ceiling
      - clcl
      - clcm
      - clch
      - clct
      - clct_mod
      - mh
      - ashfl_s
      - t_2m
      - td_2m
      - relhum_2m
      # Wind + gusts
      - u_10m
      - v_10m
      - vmax_10m
      # Accumulated precipitation components (needed for precip-rate precompute)
      - tot_prec
      - rain_gsp
      - rain_con
      - snow_gsp
      - snow_con
      - grau_gsp
      # Helpful aviation context still used in point/overlay summaries
      - vis
      - hzerocl
      - snowlmt

groups:
  aviation:
    enabled: true
    variables:
      - ww
      - cape_ml
      - cin_ml
      - htop_dc
      - hbas_sc
      - htop_sc
      - lpi
      - ceiling
      - clcl
      - clcm
      - clch
      - clct
      - clct_mod
      - cldepth
      - vis
      - hzerocl
      - snowlmt
      - mh

  surface_weather:
    enabled: true
    variables:
      - t_2m
      - td_2m
      - tmax_2m
      - tmin_2m
      - relhum_2m
      - pmsl
      - ps
      - u_10m
      - v_10m
      - vmax_10m
      - tot_prec
      - prr_gsp
      - prs_gsp
      - prg_gsp
      - rain_gsp
      - rain_con
      - snow_gsp
      - snow_con
      - grau_gsp
      - h_snow
      - freshsnw
      - t_g

  severe_weather:
    enabled: true
    variables:
      - dbz_cmax
      - dbz_ctmax
      - dbz_850
      - sdi_2
      - vorw_ctmax
      - w_ctmax
      - uh_max
      - uh_max_low
      - uh_max_med
      - echotop
      - tcond_max
      - tcond10_mx
      # lpi_max removed: D2 now downloads it via d2_variable_map (lpi → lpi_max),
      # stored as 'lpi' in NPZ — no separate download needed.

  soaring:
    enabled: true
    variables:
      - ashfl_s

static_variables:
  - hsurf

pressure_levels:
  variables: [u, v, t]
  levels: [950, 850, 700, 500, 300]

# Variables that may not exist in ICON-EU (will be skipped gracefully)
d2_only_variables:
  - cldepth
  - grau_gsp
  - dbz_cmax
  - dbz_ctmax
  - dbz_850
  - sdi_2
  - vorw_ctmax
  - w_ctmax
  - uh_max
  - uh_max_low
  - uh_max_med
  - echotop
  - tcond_max
  - tcond10_mx
  # lpi_max removed: handled via d2_variable_map (lpi → lpi_max)

# ICON-D2 variable name overrides (NPZ key → DWD filename variable).
# Use when D2 publishes a better variant under a different name:
#   lpi → lpi_max: use the 1-hour rolling maximum instead of the instantaneous value.
#                  EU equivalent is lpi_con_max (handled via eu_variable_map below).
d2_variable_map:
  lpi: lpi_max

# ICON-EU variable name overrides (NPZ key → DWD filename variable)
eu_variable_map:
  hbas_sc: hbas_con
  htop_sc: htop_con
  lpi: lpi_con_max

# Variables not available in ICON-EU (will be filled with zeros)
# Note: 'lpi' is NOT listed here — EU provides lpi_con_max via eu_variable_map above.
eu_optional_variables:
  - prr_gsp
  - prs_gsp
  - prg_gsp
  - freshsnw
